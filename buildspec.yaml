version: 0.2

phases:
  install:
    runtime-versions:
      node: 10
  build:
    commands:
      - ls
  post_build:
    commands:
      - export REVISION="{"revisionType":"S3", "s3Location":"{"bucket":"$BUCKET_DEPLOYMENTS","key":"DevOps-Pipeline-sam-/BuildOutpu/$CODEBUILD_SOURCE_VERSION/appspec.yaml","bundleType":"YAML"}"}"
      - echo $REVISION
      - echo "$BUCKET_DEPLOYMENTS"
      - echo $APPLICATION_NAME
      - echo $DEPLOYMENT_GROUP_NAME
      - echo "DevOps-Pipeline-sam-/BuildOutpu/$CODEBUILD_SOURCE_VERSION/appspec.yaml"
      - echo $CODEBUILD_SOURCE_VERSION
      - echo $CODEBUILD_WEBHOOK_PREV_COMMIT
      - aws deploy create-deployment --revision=$REVISION --application-name=$APPLICATION_NAME --deployment-group-name=$DEPLOYMENT_GROUP_NAME --deployment-config-name='CodeDeployDefault.LambdaCanary10Percent30Minutes'

artifacts:
  files:
    - "**/*"
